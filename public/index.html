<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>purple valley</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@100..900&family=Source+Serif+4:opsz,wght@8..60,200..900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="/mindcomplete-favicon.png">
  <link rel="icon" type="image/png" sizes="180x180" href="/mindcomplete-favicon.png">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header class="header">
    <div class="header-left">
      <button class="icon-btn" id="menu-btn" aria-label="Menu">
        <span class="material-symbols-outlined">dehaze</span>
      </button>
      <svg class="logo" width="151" height="26" viewBox="0 0 151 26" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="purple valley">
        <path d="M139.919 25.9178C139.118 25.9178 138.539 25.7396 138.182 25.3833C137.826 25.0448 137.648 24.6351 137.648 24.1541C137.648 23.78 137.746 23.4771 137.942 23.2455C138.138 23.0317 138.423 22.9248 138.797 22.9248C139.118 22.9248 139.367 23.0228 139.545 23.2188C139.741 23.4147 139.839 23.682 139.839 24.0205C139.839 24.2699 139.768 24.4748 139.625 24.6351C139.501 24.7954 139.349 24.9112 139.171 24.9825V25.0359C139.367 25.1072 139.625 25.1428 139.946 25.1428C140.516 25.1428 141.024 24.9201 141.469 24.4748C141.932 24.0294 142.351 23.2989 142.725 22.2835L143.34 20.6266L138.316 7.50562H136.953V6.57031H142.271V7.50562H140L144.061 18.5155H144.168L148.15 7.50562H145.879V6.57031H150.662V7.50562H149.299L143.607 22.4438C143.197 23.5305 142.69 24.3768 142.084 24.9825C141.496 25.606 140.774 25.9178 139.919 25.9178Z" fill="currentColor"/>
        <path d="M130.102 20.5736C128.249 20.5736 126.779 19.9501 125.693 18.703C124.606 17.4559 124.062 15.6922 124.062 13.4118C124.062 12.3251 124.205 11.3363 124.49 10.4455C124.793 9.55477 125.212 8.80652 125.746 8.20079C126.281 7.57725 126.913 7.09623 127.643 6.75774C128.374 6.41925 129.175 6.25 130.048 6.25C130.904 6.25 131.67 6.41034 132.347 6.73102C133.041 7.0517 133.629 7.49708 134.11 8.06718C134.591 8.61946 134.957 9.29644 135.206 10.0981C135.473 10.882 135.607 11.7372 135.607 12.6636V13.1179H125.773V13.973C125.773 15.7011 126.191 17.0283 127.029 17.9547C127.866 18.8812 128.962 19.3444 130.316 19.3444C131.438 19.3444 132.347 19.0949 133.041 18.5961C133.754 18.0973 134.297 17.4826 134.671 16.7522L135.34 17.1531C135.161 17.5806 134.921 17.9993 134.618 18.409C134.315 18.8188 133.941 19.184 133.496 19.5047C133.068 19.8254 132.569 20.0837 131.999 20.2797C131.447 20.4756 130.814 20.5736 130.102 20.5736ZM125.773 12.2093H133.977V12.0489C133.977 11.3541 133.897 10.7128 133.736 10.1249C133.576 9.53695 133.326 9.02921 132.988 8.60164C132.667 8.15625 132.258 7.81776 131.759 7.58616C131.278 7.33674 130.708 7.21203 130.048 7.21203C129.389 7.21203 128.792 7.32784 128.258 7.55944C127.741 7.79104 127.296 8.12062 126.922 8.54819C126.548 8.97576 126.263 9.4835 126.067 10.0714C125.871 10.6593 125.773 11.3096 125.773 12.0222V12.2093Z" fill="currentColor"/>
        <path d="M116.066 19.3208H118.151V1.54994L116.066 1.28271V0.587906L119.701 0V19.3208H121.785V20.2561H116.066V19.3208Z" fill="currentColor"/>
        <path d="M108.551 19.3208H110.635V1.54994L108.551 1.28271V0.587906L112.185 0V19.3208H114.269V20.2561H108.551V19.3208Z" fill="currentColor"/>
        <path d="M98.9774 20.5736C97.6769 20.5736 96.6525 20.244 95.9042 19.5849C95.1738 18.9079 94.8086 18.0082 94.8086 16.8858C94.8086 16.2267 94.9155 15.6566 95.1293 15.1755C95.3431 14.6767 95.6905 14.258 96.1715 13.9196C96.6525 13.5811 97.2671 13.3316 98.0153 13.1713C98.7814 12.9931 99.7078 12.9041 100.795 12.9041H103.173V10.686C103.173 9.54586 102.879 8.68181 102.291 8.0939C101.703 7.48817 100.848 7.18531 99.7256 7.18531C99.0843 7.18531 98.532 7.23876 98.0688 7.34565C97.6056 7.45254 97.2493 7.59507 96.9999 7.77322V7.82667C97.1958 7.91575 97.3651 8.05827 97.5076 8.25424C97.6679 8.43239 97.7481 8.6729 97.7481 8.97576C97.7481 9.33207 97.6412 9.61712 97.4274 9.83091C97.2137 10.0269 96.9286 10.1249 96.5723 10.1249C96.216 10.1249 95.931 10.0269 95.7172 9.83091C95.5034 9.61712 95.3965 9.31426 95.3965 8.92232C95.3965 8.58382 95.5034 8.25424 95.7172 7.93356C95.9488 7.61288 96.2694 7.32783 96.6792 7.07842C97.1068 6.829 97.6145 6.63303 98.2024 6.49051C98.7903 6.33017 99.4495 6.25 100.18 6.25C101.587 6.25 102.692 6.61522 103.494 7.34565C104.313 8.07608 104.723 9.11829 104.723 10.4723V19.3978H106.78V20.0926C106.602 20.2173 106.344 20.3153 106.005 20.3866C105.685 20.4756 105.355 20.5202 105.017 20.5202C103.841 20.5202 103.253 19.9323 103.253 18.7564V18.0616H103.146C103.021 18.3645 102.852 18.6674 102.638 18.9702C102.442 19.2731 102.175 19.5492 101.837 19.7986C101.498 20.0302 101.097 20.2173 100.634 20.3598C100.171 20.5024 99.6187 20.5736 98.9774 20.5736ZM99.5386 19.5047C100.572 19.5047 101.436 19.2286 102.131 18.6763C102.825 18.124 103.173 17.3757 103.173 16.4315V13.7058H101.008C100.153 13.7058 99.4317 13.7681 98.8438 13.8928C98.2737 14.0175 97.8105 14.2046 97.4542 14.454C97.1157 14.6856 96.8663 14.9796 96.7059 15.3359C96.5634 15.6744 96.4921 16.0663 96.4921 16.5117V17.1263C96.4921 17.8568 96.7594 18.4358 97.2938 18.8633C97.8283 19.2909 98.5765 19.5047 99.5386 19.5047Z" fill="currentColor"/>
        <path d="M81.2652 7.50562H79.9023V6.57031H85.2202V7.50562H82.9488L87.0106 18.5156H87.1175L91.0992 7.50562H88.8545V6.57031H93.6112V7.50562H92.2483L87.4115 20.2526H86.1288L81.2652 7.50562Z" fill="currentColor"/>
        <path d="M66.4953 20.6524C64.5891 20.6524 63.0258 19.9976 61.8054 18.6882C60.594 17.3699 59.9883 15.6418 59.9883 13.5039C59.9883 11.4284 60.5851 9.71814 61.7787 8.37307C62.9812 7.028 64.5401 6.35547 66.4552 6.35547C68.308 6.35547 69.7911 6.93002 70.9046 8.07911C72.0269 9.22821 72.5881 10.7425 72.5881 12.6221V13.4906H60.7766V12.3815H71.1985C71.1629 10.9207 70.722 9.75377 69.8757 8.88081C69.0295 7.99894 67.8893 7.55801 66.4552 7.55801C64.9053 7.55801 63.6582 8.10138 62.714 9.18812C61.7787 10.2749 61.3111 11.7135 61.3111 13.5039C61.3111 15.33 61.8099 16.7775 62.8075 17.8464C63.8141 18.9154 65.0612 19.4498 66.5487 19.4498C67.4484 19.4498 68.1878 19.2939 68.7667 18.9822C69.3546 18.6615 69.8312 18.3096 70.1964 17.9266C70.5616 17.5436 70.9046 17.0893 71.2253 16.5637L72.361 17.1249C72.0136 17.8108 71.5949 18.3943 71.105 18.8753C70.6151 19.3563 70.0049 19.775 69.2745 20.1313C68.553 20.4787 67.6266 20.6524 66.4953 20.6524Z" fill="currentColor"/>
        <path d="M55.6367 20.2548V1.12109H56.9729V20.2548H55.6367Z" fill="currentColor"/>
        <path d="M39.8555 25.9969V6.75632H41.1248V10.4174L40.8041 9.96308H41.1782C41.4989 8.9387 42.1358 8.08356 43.0889 7.39767C44.0509 6.70287 45.1688 6.35547 46.4426 6.35547C48.2509 6.35547 49.7384 7.00573 50.9053 8.30625C52.0722 9.60677 52.6557 11.3349 52.6557 13.4905C52.6557 15.6284 52.0633 17.3565 50.8786 18.6748C49.7028 19.9931 48.2063 20.6523 46.3892 20.6523C45.1421 20.6523 44.0554 20.345 43.129 19.7304C42.2026 19.1157 41.5702 18.3007 41.2317 17.2852L41.1916 17.2986V25.9969H39.8555ZM46.2689 19.4498C47.7031 19.4498 48.9011 18.9153 49.8631 17.8464C50.8341 16.7775 51.3195 15.3255 51.3195 13.4905C51.3195 11.6466 50.843 10.1991 49.8899 9.14803C48.9367 8.08801 47.7387 7.55801 46.2957 7.55801C44.8081 7.55801 43.5744 8.09692 42.5945 9.17475C41.6147 10.2526 41.1248 11.7223 41.1248 13.5841C41.1248 15.3389 41.6058 16.7552 42.5678 17.833C43.5298 18.9108 44.7635 19.4498 46.2689 19.4498Z" fill="currentColor"/>
        <path d="M30.375 20.2515V6.75632H31.6443V9.52217L31.4038 9.3351H31.6978C31.9739 8.39088 32.4861 7.66045 33.2343 7.1438C33.9826 6.61825 34.7843 6.35547 35.6394 6.35547C35.9155 6.35547 36.1739 6.37774 36.4144 6.42228C36.6638 6.45791 36.8731 6.50245 37.0424 6.55589C37.2205 6.60934 37.3096 6.63606 37.3096 6.63606V8.02567C37.3096 8.02567 37.1982 7.99449 36.9756 7.93214C36.7529 7.86087 36.5168 7.80743 36.2674 7.7718C36.018 7.72726 35.773 7.70499 35.5325 7.70499C34.4725 7.70499 33.5684 8.11029 32.8201 8.92089C32.0808 9.72259 31.7111 10.8182 31.7111 12.2078V20.2515H30.375Z" fill="currentColor"/>
        <path d="M20.4775 20.6539C18.9454 20.6539 17.7562 20.204 16.91 19.3043C16.0637 18.3958 15.6406 17.0863 15.6406 15.376V6.75781H16.9634V15.1756C16.9634 16.5474 17.2841 17.603 17.9254 18.3423C18.5757 19.0816 19.5199 19.4513 20.7581 19.4513C22.112 19.4513 23.2032 18.9703 24.0316 18.0083C24.86 17.0373 25.2742 15.8125 25.2742 14.3338V6.75781H26.6104V20.253H25.341V16.7656L25.9423 17.3669H25.2876C24.9847 18.3111 24.4013 19.095 23.5372 19.7186C22.6732 20.3421 21.6533 20.6539 20.4775 20.6539Z" fill="currentColor"/>
        <path d="M0 25.9969V6.75632H1.26933V10.4174L0.948658 9.96308H1.32278C1.64345 8.9387 2.28034 8.08356 3.23345 7.39767C4.19547 6.70287 5.31337 6.35547 6.58716 6.35547C8.3954 6.35547 9.88297 7.00573 11.0499 8.30625C12.2168 9.60677 12.8002 11.3349 12.8002 13.4905C12.8002 15.6284 12.2078 17.3565 11.0231 18.6748C9.84733 19.9931 8.35086 20.6523 6.53371 20.6523C5.28665 20.6523 4.19993 20.345 3.27354 19.7304C2.34715 19.1157 1.71471 18.3007 1.37622 17.2852L1.33614 17.2986V25.9969H0ZM6.41346 19.4498C7.84758 19.4498 9.04565 18.9153 10.0077 17.8464C10.9786 16.7775 11.4641 15.3255 11.4641 13.4905C11.4641 11.6466 10.9875 10.1991 10.0344 9.14803C9.08128 8.08801 7.88321 7.55801 6.44018 7.55801C4.95262 7.55801 3.71892 8.09692 2.73908 9.17475C1.75925 10.2526 1.26933 11.7223 1.26933 13.5841C1.26933 15.3389 1.75034 16.7552 2.71236 17.833C3.67438 18.9108 4.90808 19.4498 6.41346 19.4498Z" fill="currentColor"/>
      </svg>
    </div>
    <div class="header-right">
      <button class="icon-btn" id="settings-btn" aria-label="Settings">
        <span class="material-symbols-outlined">edit</span>
      </button>
    </div>
  </header>

  <!-- Select confirm button (floating) -->
  <button class="select-confirm-btn" aria-label="Confirm selection">
    <span class="material-symbols-outlined">check</span>
  </button>

  <!-- Gradient overlay to fade text under header -->
  <div class="header-gradient-overlay"></div>

  <!-- Burger Menu Overlay -->
  <div class="menu-overlay right-menu-overlay">
    <div class="menu-content">
      <button class="menu-item context-menu-btn">
        <span class="material-symbols-outlined">apps</span>
        <span class="menu-label">Manage context</span>
      </button>
      <button class="menu-item create-image-btn">
        <span class="material-symbols-outlined">image</span>
        <span class="menu-label">Create image</span>
      </button>
      <button class="menu-item select-menu-btn">
        <span class="material-symbols-outlined">text_select_end</span>
        <span class="menu-label">Select part</span>
      </button>
      <button class="menu-item share-menu-btn">
        <span class="material-symbols-outlined">ios_share</span>
        <span class="menu-label">Share</span>
      </button>
      <button class="menu-item clear-menu-btn">
        <span class="material-symbols-outlined">ink_eraser</span>
        <span class="menu-label">Clear</span>
      </button>
      <button class="menu-item save-valley-btn">
        <span class="material-symbols-outlined">save</span>
        <span class="menu-label">Save valley</span>
      </button>
    </div>
  </div>

  <!-- Left Menu Overlay -->
  <div class="menu-overlay left-menu-overlay">
    <div class="menu-content left-aligned">
      <button class="menu-item theme-toggle-btn">
        <span class="material-symbols-outlined">light_mode</span>
        <span class="menu-label">Light mode</span>
      </button>
      <button class="menu-item valleys-menu-btn">
        <span class="material-symbols-outlined">landscape</span>
        <span class="menu-label">Valleys</span>
      </button>
      <button class="menu-item profile-menu-btn">
        <span class="material-symbols-outlined">person</span>
        <span class="menu-label">Sign In</span>
      </button>
      <button class="menu-item about-menu-btn">
        <span class="material-symbols-outlined">info</span>
        <span class="menu-label">About</span>
      </button>
    </div>
  </div>

  <div class="container">
    <div class="editor-wrapper">
      <!-- Editable layer with inline predictions -->
      <div class="editor" contenteditable="true" data-placeholder="What's on your mind" spellcheck="false"></div>
    </div>
  </div>

  <!-- About Modal -->
  <!-- About Modal -->
  <div class="modal" id="about-modal">
    <div class="modal-content context-modal-content">
      <!-- Modal Header -->
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">About</span>
        <button class="context-modal-close" id="about-modal-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="context-modal-body">
        <div class="context-section">
          <div class="section-header">
            <h3 class="section-title">Purple Valley</h3>
            <p class="section-description">
              Purple Valley helps you expand your ideas by completing your thoughts with AI. Start typing, pause, and
              watch your ideas flow.
              <br><br>
              Click in the middle to accept part. Tab to accept full suggestion.
            </p>
          </div>

          <div class="modal-donate">
            <p class="section-description" style="margin-bottom: 16px;">Enjoying purple valley?</p>
            <a href="https://buymeacoffee.com/yourusername" target="_blank" rel="noopener noreferrer"
              class="donate-btn">
              <span>â˜•</span> Buy me a coffee
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Context Upload Modal -->
  <div class="modal" id="context-modal">
    <div class="modal-content context-modal-content">
      <!-- Modal Header -->
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">Manage context</span>
        <button class="context-modal-close" id="context-modal-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="context-modal-body">
        <!-- Section 1: Add Rules -->
        <div class="context-section">
          <div class="section-header">
            <h3 class="section-title">Add rules</h3>
            <p class="section-description">This is a field to add context to make magic complete understand you faster.
            </p>
          </div>
          <textarea id="context-textarea" placeholder="Write or paste your rules"></textarea>
          <div class="section-buttons">
            <button class="btn-white" id="save-rules-btn">Save rules</button>
            <button class="btn-secondary" id="clear-rules-btn">Clear rules</button>
            <span class="rules-status" id="rules-status"></span>
          </div>
        </div>

        <!-- Section 2: Upload Files -->
        <div class="context-section">
          <div class="section-header">
            <h3 class="section-title">Upload files</h3>
            <p class="section-description">Upload files to help the AI understand what you're writing about.</p>
          </div>
          <div class="context-files" id="context-files"></div>
          <input type="file" id="file-input" multiple accept=".pdf,.txt,.md,text/plain,text/markdown,application/pdf"
            class="visually-hidden">
          <div class="context-status" id="context-status"></div>
          <div class="section-buttons">
            <button class="btn-white" id="upload-btn">
              <span class="material-symbols-outlined">attach_file</span>
              Upload files
            </button>
            <button class="btn-secondary" id="remove-files-btn">Remove files</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Guidance Modal -->
  <div class="modal" id="image-guidance-modal">
    <div class="modal-content image-guidance-modal-content">
      <div class="image-guidance-header">
        <div class="header-spacer"></div>
        <span class="image-guidance-title">Add image context</span>
        <button class="image-guidance-close" id="image-guidance-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="image-guidance-body">
        <textarea id="image-guidance-textarea" placeholder="Optional"></textarea>
        <div class="image-guidance-buttons">
          <button class="btn-secondary" id="skip-guidance-btn">Skip</button>
          <button class="btn-white" id="apply-guidance-btn">Add context</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Valleys Modal -->
  <div class="modal" id="valleys-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">Valleys</span>
        <button class="context-modal-close" id="valleys-modal-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="context-modal-body">
        <div class="context-section">
          <div class="section-header">
            <p class="section-description">Your saved valleys</p>
          </div>
          <div class="valleys-list" id="valleys-list"></div>
          <div class="valleys-empty" id="valleys-empty">
            <p class="section-description">No valleys saved yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="auth-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title" id="auth-modal-title">Sign In</span>
        <button class="context-modal-close" id="auth-modal-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="context-modal-body">
        <div class="context-section" id="auth-form-section">
          <!-- Auth Tabs -->
          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signin">Sign In</button>
            <button class="auth-tab" data-tab="signup">Sign Up</button>
          </div>

          <!-- Email Input -->
          <input type="email" id="auth-email" class="auth-input" placeholder="Email">

          <!-- Password Input -->
          <input type="password" id="auth-password" class="auth-input" placeholder="Password">

          <!-- Error Message -->
          <div class="auth-error" id="auth-error"></div>

          <!-- Submit Button -->
          <div class="section-buttons">
            <button class="btn-white" id="auth-submit-btn">Sign In</button>
          </div>

          <!-- Divider -->
          <div class="auth-divider">
            <span>or</span>
          </div>

          <!-- Social Login -->
          <button class="btn-social" id="google-signin-btn">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.64 9.205c0-.639-.057-1.252-.164-1.841H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615Z" fill="#4285F4"/>
              <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18Z" fill="#34A853"/>
              <path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332Z" fill="#FBBC05"/>
              <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58Z" fill="#EA4335"/>
            </svg>
            Continue with Google
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Modal -->
  <div class="modal" id="account-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">Account</span>
        <button class="context-modal-close" id="account-modal-close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="context-modal-body">
        <div class="context-section">
          <div class="account-email" id="account-email"></div>
          <div class="section-buttons account-buttons">
            <button class="btn-white" id="signout-btn">Sign Out</button>
            <button class="btn-danger" id="delete-account-btn">Delete Account</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="supabaseClient.js"></script>
  <script src="app.js"></script>
</body>

</html>