<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mindcomplete</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:wght@100..900&family=Inter:wght@100..900&family=Literata:ital,opsz,wght@0,7..72,200..900;1,7..72,200..900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="/mindcomplete-favicon.png">
  <link rel="icon" type="image/png" sizes="180x180" href="/mindcomplete-favicon.png">
  <link rel="stylesheet" href="styles.css?v=toolbar-fix-3">
</head>

<body class="sidebar-collapsed">
  <!-- Dashboard View -->
  <div id="dashboard-view" class="view-container dashboard-view">
    <header class="dashboard-header">
      <div class="header-left">
        <div class="logo-container">
          <a href="/" class="logo-link">
            <img src="/logo.png" alt="Mindcomplete" style="height: 26px; width: auto;" class="dashboard-logo">
          </a>
          <path
            d="M72.4626 21.63V8.37H74.5686V10.32H74.6726C75.0192 9.67866 75.5826 9.124 76.3626 8.656C77.1599 8.188 78.0266 7.954 78.9626 7.954C80.5919 7.954 81.8139 8.43066 82.6286 9.384C83.4606 10.32 83.8766 11.568 83.8766 13.128V21.63H81.6666V13.466C81.6666 12.1833 81.3546 11.282 80.7306 10.762C80.1239 10.2247 79.3352 9.956 78.3646 9.956C77.6366 9.956 76.9952 10.164 76.4406 10.58C75.8859 10.9787 75.4526 11.4987 75.1406 12.14C74.8286 12.7813 74.6726 13.4573 74.6726 14.168V21.63H72.4626Z"
            fill="#D9D9D9" />
          <path
            d="M67.029 21.63V8.37H69.239V21.63H67.029ZM68.121 5.926C67.6877 5.926 67.315 5.77 67.003 5.458C66.691 5.146 66.535 4.77333 66.535 4.34C66.535 3.88933 66.691 3.51666 67.003 3.222C67.315 2.91 67.6877 2.754 68.121 2.754C68.5717 2.754 68.9443 2.91 69.239 3.222C69.551 3.51666 69.707 3.88933 69.707 4.34C69.707 4.77333 69.551 5.146 69.239 5.458C68.9443 5.77 68.5717 5.926 68.121 5.926Z"
            fill="#D9D9D9" />
          <path
            d="M205.706 22.046C204.424 22.046 203.28 21.7427 202.274 21.136C201.286 20.5293 200.506 19.6973 199.934 18.64C199.38 17.5827 199.102 16.378 199.102 15.026C199.102 13.7607 199.362 12.5907 199.882 11.516C200.42 10.4413 201.165 9.58334 202.118 8.94201C203.089 8.28334 204.224 7.95401 205.524 7.95401C206.842 7.95401 207.968 8.24867 208.904 8.83801C209.858 9.41001 210.586 10.2073 211.088 11.23C211.608 12.2527 211.868 13.4227 211.868 14.74C211.868 14.8613 211.86 14.9827 211.842 15.104C211.842 15.2253 211.834 15.3293 211.816 15.416H200.402V13.596H209.528C209.511 13.232 209.424 12.842 209.268 12.426C209.13 11.9927 208.896 11.594 208.566 11.23C208.254 10.8487 207.847 10.5453 207.344 10.32C206.859 10.0773 206.252 9.95601 205.524 9.95601C204.658 9.95601 203.904 10.1813 203.262 10.632C202.638 11.0653 202.153 11.6633 201.806 12.426C201.477 13.1887 201.312 14.0553 201.312 15.026C201.312 16.1527 201.529 17.0887 201.962 17.834C202.396 18.5793 202.95 19.134 203.626 19.498C204.32 19.862 205.039 20.044 205.784 20.044C206.755 20.044 207.552 19.8187 208.176 19.368C208.818 18.9 209.329 18.328 209.71 17.652L211.582 18.562C211.062 19.5673 210.317 20.3993 209.346 21.058C208.376 21.7167 207.162 22.046 205.706 22.046Z"
            fill="#D9D9D9" />
          <path
            d="M189.372 10.372V8.37001H191.842V10.372H189.372ZM195.404 21.838C194.294 21.838 193.402 21.5087 192.726 20.85C192.05 20.174 191.712 19.2727 191.712 18.146V4.62601H193.922V17.6C193.922 18.3453 194.069 18.9 194.364 19.264C194.676 19.6107 195.135 19.784 195.742 19.784C196.019 19.784 196.279 19.7493 196.522 19.68C196.764 19.5933 196.998 19.4807 197.224 19.342V21.5C196.946 21.504 196.66 21.682 196.366 21.734C196.071 21.8033 195.75 21.838 195.404 21.838ZM193.792 10.372V8.37001H197.172V10.372H193.792Z"
            fill="#D9D9D9" />
          <path
            d="M181.661 22.046C180.379 22.046 179.235 21.7427 178.229 21.136C177.241 20.5293 176.461 19.6973 175.889 18.64C175.335 17.5827 175.057 16.378 175.057 15.026C175.057 13.7607 175.317 12.5907 175.837 11.516C176.375 10.4413 177.12 9.58334 178.073 8.94201C179.044 8.28334 180.179 7.95401 181.479 7.95401C182.797 7.95401 183.923 8.24867 184.859 8.83801C185.813 9.41001 186.541 10.2073 187.043 11.23C187.563 12.2527 187.823 13.4227 187.823 14.74C187.823 14.8613 187.815 14.9827 187.797 15.104C187.797 15.2253 187.789 15.3293 187.771 15.416H176.357V13.596H185.483C185.466 13.232 185.379 12.842 185.223 12.426C185.085 11.9927 184.851 11.594 184.521 11.23C184.209 10.8487 183.802 10.5453 183.299 10.32C182.814 10.0773 182.207 9.95601 181.479 9.95601C180.613 9.95601 179.859 10.1813 179.217 10.632C178.593 11.0653 178.108 11.6633 177.761 12.426C177.432 13.1887 177.267 14.0553 177.267 15.026C177.267 16.1527 177.484 17.0887 177.917 17.834C178.351 18.5793 178.905 19.134 179.581 19.498C180.275 19.862 180.994 20.044 181.739 20.044C182.71 20.044 183.507 19.8187 184.131 19.368C184.773 18.9 185.284 18.328 185.665 17.652L187.537 18.562C187.017 19.5673 186.272 20.3993 185.301 21.058C184.331 21.7167 183.117 22.046 181.661 22.046Z"
            fill="#D9D9D9" />
          <path d="M170.326 21.63V3.01401H172.536V21.63H170.326Z" fill="#D9D9D9" />
          <path
            d="M154.736 27.246V8.37001H156.842V10.346H156.946C157.189 9.93001 157.527 9.54001 157.96 9.17601C158.411 8.81201 158.931 8.51734 159.52 8.29201C160.109 8.06667 160.759 7.95401 161.47 7.95401C162.683 7.95401 163.767 8.25734 164.72 8.86401C165.673 9.47067 166.427 10.3027 166.982 11.36C167.537 12.4173 167.814 13.6307 167.814 15C167.814 16.3693 167.537 17.5827 166.982 18.64C166.427 19.6973 165.673 20.5293 164.72 21.136C163.767 21.7427 162.683 22.046 161.47 22.046C160.413 22.046 159.485 21.8033 158.688 21.318C157.891 20.8327 157.31 20.2867 156.946 19.68H156.842L156.946 21.5V27.246H154.736ZM161.236 20.044C161.999 20.044 162.709 19.8447 163.368 19.446C164.044 19.03 164.581 18.4407 164.98 17.678C165.396 16.9153 165.604 16.0227 165.604 15C165.604 13.96 165.396 13.0673 164.98 12.322C164.581 11.5593 164.044 10.9787 163.368 10.58C162.709 10.164 161.999 9.95601 161.236 9.95601C160.473 9.95601 159.754 10.164 159.078 10.58C158.419 10.9787 157.882 11.5593 157.466 12.322C157.05 13.0673 156.842 13.96 156.842 15C156.842 16.04 157.05 16.9413 157.466 17.704C157.882 18.4493 158.419 19.03 159.078 19.446C159.754 19.8447 160.473 20.044 161.236 20.044Z"
            fill="#D9D9D9" />
          <path
            d="M132.037 21.63V8.37001H134.143V10.32H134.247C134.489 9.88667 134.819 9.49667 135.235 9.15001C135.668 8.78601 136.153 8.50001 136.691 8.29201C137.245 8.06667 137.809 7.95401 138.381 7.95401C139.369 7.95401 140.218 8.19667 140.929 8.68201C141.639 9.15001 142.151 9.76534 142.463 10.528C142.913 9.78267 143.52 9.16734 144.283 8.68201C145.045 8.19667 145.955 7.95401 147.013 7.95401C148.59 7.95401 149.751 8.43067 150.497 9.38401C151.242 10.3373 151.615 11.5853 151.615 13.128V21.63H149.431V13.466C149.431 12.1833 149.171 11.282 148.651 10.762C148.131 10.2247 147.394 9.95601 146.441 9.95601C145.765 9.95601 145.158 10.1553 144.621 10.554C144.101 10.9353 143.685 11.4467 143.373 12.088C143.078 12.712 142.931 13.3967 142.931 14.142V21.63H140.721V13.492C140.721 12.2093 140.461 11.2993 139.941 10.762C139.421 10.2247 138.693 9.95601 137.757 9.95601C137.081 9.95601 136.474 10.1553 135.937 10.554C135.417 10.9527 135.001 11.4727 134.689 12.114C134.394 12.7553 134.247 13.4487 134.247 14.194V21.63H132.037Z"
            fill="#D9D9D9" />
          <path
            d="M122.709 22.046C121.375 22.046 120.196 21.734 119.173 21.11C118.151 20.486 117.345 19.6453 116.755 18.588C116.183 17.5133 115.897 16.3173 115.897 15C115.897 13.6827 116.183 12.4953 116.755 11.438C117.345 10.3633 118.151 9.51401 119.173 8.89001C120.196 8.26601 121.375 7.95401 122.709 7.95401C124.044 7.95401 125.223 8.27467 126.245 8.91601C127.268 9.54001 128.065 10.3893 128.637 11.464C129.227 12.5213 129.521 13.7 129.521 15C129.521 16.3173 129.227 17.5133 128.637 18.588C128.065 19.6453 127.268 20.486 126.245 21.11C125.223 21.734 124.044 22.046 122.709 22.046ZM122.709 20.044C123.507 20.044 124.252 19.8447 124.945 19.446C125.656 19.0473 126.228 18.4753 126.661 17.73C127.095 16.9673 127.311 16.0573 127.311 15C127.311 13.9427 127.095 13.0413 126.661 12.296C126.228 11.5333 125.656 10.9527 124.945 10.554C124.252 10.1553 123.507 9.95601 122.709 9.95601C121.912 9.95601 121.158 10.1553 120.447 10.554C119.737 10.9527 119.165 11.5333 118.731 12.296C118.298 13.0413 118.081 13.9427 118.081 15C118.081 16.0573 118.298 16.9673 118.731 17.73C119.165 18.4753 119.737 19.0473 120.447 19.446C121.158 19.8447 121.912 20.044 122.709 20.044Z"
            fill="#D9D9D9" />
          <path
            d="M108.564 22.046C107.264 22.046 106.103 21.7427 105.08 21.136C104.075 20.512 103.286 19.6713 102.714 18.614C102.142 17.5393 101.856 16.3347 101.856 15C101.856 13.648 102.142 12.4433 102.714 11.386C103.286 10.3287 104.075 9.49668 105.08 8.89001C106.103 8.26601 107.264 7.95401 108.564 7.95401C110.055 7.95401 111.277 8.30067 112.23 8.99401C113.201 9.67001 113.886 10.5453 114.284 11.62L112.282 12.452C111.953 11.6373 111.459 11.022 110.8 10.606C110.159 10.1727 109.379 9.95601 108.46 9.95601C107.68 9.95601 106.952 10.164 106.276 10.58C105.618 10.996 105.08 11.5853 104.664 12.348C104.248 13.0933 104.04 13.9773 104.04 15C104.04 16.0053 104.248 16.8893 104.664 17.652C105.08 18.4147 105.618 19.004 106.276 19.42C106.952 19.836 107.68 20.044 108.46 20.044C109.396 20.044 110.202 19.8273 110.878 19.394C111.554 18.9607 112.057 18.3453 112.386 17.548L114.362 18.38C113.929 19.4027 113.227 20.2693 112.256 20.98C111.286 21.6907 110.055 22.046 108.564 22.046Z"
            fill="#D9D9D9" />
          <path
            d="M44 21.63V8.37001H46.106V10.32H46.21C46.4527 9.88668 46.782 9.49668 47.198 9.15001C47.6313 8.78601 48.1167 8.50001 48.654 8.29201C49.2087 8.06668 49.772 7.95401 50.344 7.95401C51.332 7.95401 52.1813 8.19668 52.892 8.68201C53.6027 9.15001 54.114 9.76534 54.426 10.528C54.8767 9.78268 55.4833 9.16734 56.246 8.68201C57.0087 8.19668 57.9187 7.95401 58.976 7.95401C60.5533 7.95401 61.7147 8.43068 62.46 9.38401C63.2053 10.3373 63.578 11.5853 63.578 13.128V21.63H61.394V13.466C61.394 12.1833 61.134 11.282 60.614 10.762C60.094 10.2247 59.3573 9.95601 58.404 9.95601C57.728 9.95601 57.1213 10.1553 56.584 10.554C56.064 10.9353 55.648 11.4467 55.336 12.088C55.0413 12.712 54.894 13.3967 54.894 14.142V21.63H52.684V13.492C52.684 12.2093 52.424 11.2993 51.904 10.762C51.384 10.2247 50.656 9.95601 49.72 9.95601C49.044 9.95601 48.4373 10.1553 47.9 10.554C47.38 10.9527 46.964 11.4727 46.652 12.114C46.3573 12.7553 46.21 13.4487 46.21 14.194V21.63H44Z"
            fill="#D9D9D9" />
          </svg>
          </a>

        </div>
      </div>
      <div class="header-right">

        <button class="avatar-btn" id="dashboard-account-btn">
          <div class="user-avatar" id="dashboard-avatar">
            <span class="material-symbols-outlined">person</span>
          </div>
        </button>
      </div>
    </header>

    <main class="dashboard-content">

      <div class="projects-grid" id="projects-grid">
        <!-- Create New Project Card -->
        <div class="project-card create-card" id="create-project-card">
          <div class="create-icon-wrapper">
            <span class="material-symbols-outlined">add</span>
          </div>
          <span class="create-label">Create new notebook</span>
        </div>
        <!-- Projects will be injected here -->
      </div>
    </main>
  </div>

  <!-- Editor View -->
  <div id="editor-view" class="view-container editor-view" style="display: none;">
    <div class="app-shell">
      <!-- Sidebar Removed -->

      <div class="app-main" style="padding-left: 0;"> <!-- Explicitly remove padding reserved for sidebar if any -->
        <header class="header">
          <div class="header-left">
            <button class="logo-back-btn" id="back-to-dashboard-btn" aria-label="Back to Dashboard">
              <img src="/symbol.png" alt="Mindcomplete Symbol" style="height: 26px; width: auto;">
            </button>
            <div class="project-title-container">
              <div class="emoji-picker-container">
                <button id="project-emoji-btn" class="project-emoji-btn" aria-label="Change Icon">
                  <span id="project-emoji-display" class="project-emoji-display">üìù</span>
                </button>
                <div class="emoji-picker-dropdown" id="emoji-picker-dropdown">
                  <div class="emoji-grid" id="emoji-grid">
                    <!-- Emojis will be injected here -->
                  </div>
                </div>
              </div>
              <div class="title-wrapper">
                <span class="project-title-display" id="project-title-display">Untitled Project</span>
                <input type="text" id="project-title-input" class="project-title-input" placeholder="Untitled Project"
                  spellcheck="false">
              </div>

            </div>

          </div>
          <div class="header-right">

            <button class="btn-secondary btn-sm" id="settings-btn" aria-label="Context">
              Context
            </button>
          </div>
        </header>

        <!-- Gradient overlay to fade text under header -->
        <div class="header-gradient-overlay"></div>

        <!-- Right Side Menu Panel (Brain) -->
        <div class="side-menu-backdrop" id="side-menu-backdrop"></div>
        <div class="side-menu brain-panel" id="side-menu">
          <div class="side-menu-resizer"></div>
          <div class="brain-header">
            <h2 class="brain-title">
              Context
            </h2>
            <button class="btn-icon side-menu-close" id="side-menu-close" aria-label="Close">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>

          <!-- Stack of Context Anchors (Scrollable) -->
          <div class="brain-content" id="brain-anchors-list">
            <!-- Empty State -->
            <div class="brain-empty-state" id="brain-empty-state">
              <p>Add context to help the AI understand<br>your project.</p>
            </div>
            <!-- Anchors will be injected here -->
          </div>

          <!-- Fixed Bottom Input Area -->
          <div class="brain-input-area">
            <div class="brain-input-container">
              <!-- Attachment Preview (Dynamic) -->
              <div class="brain-attachment-preview" id="brain-attachment-preview" style="display: none;">
                <div class="attachment-chip">
                  <span class="material-symbols-outlined" id="attachment-icon">description</span>
                  <span class="attachment-name" id="attachment-name">file.txt</span>
                  <button class="btn-icon-small" id="remove-attachment-btn">
                    <span class="material-symbols-outlined">close</span>
                  </button>
                </div>
              </div>

              <div class="brain-input-controls">
                <button class="btn-icon brain-attach-btn" id="brain-attach-btn" aria-label="Attach file">
                  <span class="material-symbols-outlined">attach_file</span>
                </button>
                <textarea class="brain-textarea" id="brain-input-text" placeholder="Add context" rows="1"></textarea>
                <button class="btn-icon-primary brain-send-btn" id="brain-send-btn" aria-label="Send">
                  <span class="material-symbols-outlined">arrow_upward</span>
                </button>
              </div>
            </div>

            <!-- Hidden File Input -->
            <input type="file" id="context-file-input"
              accept=".txt,.md,.png,.jpg,.jpeg,.webp,image/*,text/plain,text/markdown" class="visually-hidden">
          </div>
        </div>

        <div class="container">
          <div class="editor-wrapper">
            <!-- Editable layer with inline predictions -->
            <div class="editor" contenteditable="true" data-placeholder="What's on your mind" spellcheck="false"></div>
          </div>
        </div>

        <!-- Floating Editor Toolbar -->
        <div class="editor-toolbar">
          <button class="toolbar-btn clear-menu-btn" aria-label="Clear">
            <span class="material-symbols-outlined">ink_eraser</span>
          </button>
          <button class="toolbar-btn create-image-btn" aria-label="Create image">
            <span class="material-symbols-outlined">add_photo_alternate</span>
          </button>
          <button class="toolbar-btn toggle-prediction-btn" aria-label="Auto-prediction">
            <span class="material-symbols-outlined">auto_fix_high</span>
          </button>
          <button class="toolbar-btn copy-all-btn" aria-label="Copy all">
            <span class="material-symbols-outlined">content_copy</span>
          </button>
          <button class="toolbar-btn select-menu-btn" aria-label="Select part">
            <span class="material-symbols-outlined">text_select_end</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <!-- About Modal -->
  <div class="modal" id="about-modal">
    <div class="modal-content context-modal-content">
      <!-- Modal Header -->
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">About</span>
        <div class="header-spacer"></div>
      </div>

      <!-- Modal Body -->
      <div class="context-modal-body">
        <div class="context-section">
          <div class="section-header">
            <h3 class="section-title">Mindcomplete</h3>
            <p class="section-description">
              Mindcomplete helps you expand your ideas by completing your thoughts with AI. Start typing, pause, and
              watch your ideas flow.
              <br><br>
              Click in the middle to accept part. Tab to accept full suggestion.
            </p>
          </div>

          <div class="modal-donate">
            <p class="section-description" style="margin-bottom: 16px;">Enjoying Mindcomplete?</p>
            <a href="https://buymeacoffee.com/yourusername" target="_blank" rel="noopener noreferrer"
              class="donate-btn">
              <span>‚òï</span> Buy me a coffee
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Files Modal (Desktop) -->
  <div class="modal" id="files-modal">
    <div class="modal-content files-modal-content">
      <div class="files-dropzone" id="files-dropzone">
        <div class="files-dropzone-icon">
          <span class="material-symbols-outlined">upload_file</span>
        </div>
        <div class="files-dropzone-title">Drop files here</div>
        <div class="files-dropzone-text">PDF, TXT, or Markdown files</div>
        <button class="btn-primary" id="browse-files-btn">Browse files</button>
      </div>
      <div class="files-list" id="files-list-section">
        <div class="files-list-header">
          <span class="files-list-title">Uploaded files</span>
          <span class="files-list-count" id="files-count">0 files</span>
        </div>
        <div id="files-list"></div>
      </div>
      <input type="file" id="file-input" multiple accept=".pdf,.txt,.md,text/plain,text/markdown,application/pdf"
        class="visually-hidden">
    </div>
  </div>

  <!-- Rules Modal (Desktop) -->
  <div class="modal" id="rules-modal">
    <div class="modal-content rules-modal-content">
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">Add rules</span>
        <div class="header-spacer"></div>
      </div>
      <div class="rules-modal-body">
        <p class="rules-description">Add rules to help the AI understand how to complete your thoughts.</p>
        <textarea class="rules-textarea" id="rules-textarea" placeholder="Write or paste your rules"></textarea>
        <div class="rules-buttons">
          <button class="btn-primary" id="save-rules-btn">Save rules</button>
          <button class="btn-secondary" id="clear-rules-btn">Clear rules</button>
          <span class="rules-status" id="rules-status"></span>
        </div>

        <div class="writing-style-modal-section"
          style="margin-top: 36px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; display: flex; flex-direction: column; gap: 0;">
          <h3 class="side-menu-title" style="margin-bottom: 8px;">Writing Style</h3>
          <p class="rules-description" style="margin-bottom: 12px;">Choose how the AI should write for you.</p>

          <div class="custom-dropdown" id="style-dropdown">
            <button class="custom-dropdown-trigger">
              <span class="selected-value">No specific style</span>
              <span class="material-symbols-outlined">expand_more</span>
            </button>
            <div class="custom-dropdown-menu">
              <div class="custom-dropdown-item" data-value="none">No specific style</div>
              <div class="custom-dropdown-item" data-value="social">Social Media (short, concise)</div>
              <div class="custom-dropdown-item" data-value="story">Story (descriptive, narrative)</div>
              <div class="custom-dropdown-item" data-value="ideation">Ideation (expansive, creative)</div>
              <div class="custom-dropdown-item" data-value="custom">Custom style...</div>
            </div>
          </div>

          <textarea class="rules-textarea" id="custom-style-textarea"
            placeholder="Describe your custom writing style..." style="display: none;"></textarea>
          <div class="rules-buttons" style="margin-top: 12px;">
            <button class="btn-primary" id="save-style-btn">Save style</button>
            <button class="btn-secondary" id="clear-style-btn">Clear style</button>
            <span class="rules-status" id="style-status"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Files Bottom Sheet (Mobile) -->
  <div class="bottom-sheet-overlay" id="files-bottom-sheet">
    <div class="bottom-sheet files-bottom-sheet">
      <div class="files-sheet-handle">
        <div class="bottom-sheet-handle-bar"></div>
      </div>
      <div class="bottom-sheet-body">
        <div class="files-dropzone" id="files-dropzone-mobile">
          <div class="files-dropzone-icon">
            <span class="material-symbols-outlined">upload_file</span>
          </div>
          <div class="files-dropzone-title">Drop files here</div>
          <div class="files-dropzone-text">PDF, TXT, or Markdown</div>
          <button class="btn-primary" id="browse-files-btn-mobile">Browse files</button>
        </div>
        <div class="files-list" id="files-list-section-mobile">
          <div class="files-list-header">
            <span class="files-list-title">Files</span>
            <span class="files-list-count" id="files-count-mobile">0</span>
          </div>
          <div id="files-list-mobile"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rules Bottom Sheet (Mobile) -->
  <div class="bottom-sheet-overlay" id="rules-bottom-sheet">
    <div class="bottom-sheet">
      <div class="bottom-sheet-handle">
        <div class="bottom-sheet-handle-bar"></div>
      </div>
      <div class="bottom-sheet-header">
        <span class="bottom-sheet-title">Add rules</span>
      </div>
      <div class="bottom-sheet-body">
        <div class="rules-modal-body">
          <p class="rules-description">Add rules to help the AI understand how to complete your thoughts.</p>
          <textarea class="rules-textarea" id="rules-textarea-mobile"
            placeholder="Write or paste your rules"></textarea>
          <div class="rules-buttons">
            <button class="btn-primary" id="save-rules-btn-mobile">Save</button>
            <button class="btn-secondary" id="clear-rules-btn-mobile">Clear</button>
          </div>

          <div class="writing-style-modal-section"
            style="margin-top: 36px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; display: flex; flex-direction: column; gap: 0;">
            <h3 class="side-menu-title" style="margin-bottom: 8px;">Writing Style</h3>
            <p class="rules-description" style="margin-bottom: 12px;">Choose how the AI should write for you.</p>

            <div class="custom-dropdown" id="style-dropdown-mobile">
              <button class="custom-dropdown-trigger">
                <span class="selected-value">No specific style</span>
                <span class="material-symbols-outlined">expand_more</span>
              </button>
              <div class="custom-dropdown-menu">
                <div class="custom-dropdown-item" data-value="none">No specific style</div>
                <div class="custom-dropdown-item" data-value="social">Social Media (short, concise)</div>
                <div class="custom-dropdown-item" data-value="story">Story (descriptive, narrative)</div>
                <div class="custom-dropdown-item" data-value="ideation">Ideation (expansive, creative)</div>
                <div class="custom-dropdown-item" data-value="custom">Custom style...</div>
              </div>
            </div>

            <textarea class="rules-textarea" id="custom-style-textarea-mobile"
              placeholder="Describe your custom writing style..." style="display: none;"></textarea>
            <div class="rules-buttons" style="margin-top: 12px;">
              <button class="btn-primary" id="save-style-btn-mobile">Save style</button>
              <button class="btn-secondary" id="clear-style-btn-mobile">Clear</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Guidance Modal -->
  <div class="modal" id="image-guidance-modal">
    <div class="modal-content image-guidance-modal-content">
      <div class="context-modal-header close-only">
        <button class="context-modal-close" id="image-guidance-close" aria-label="Close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <!-- Authorized View -->
      <div class="image-guidance-body" id="image-guidance-auth-view">
        <div class="image-guidance-field">
          <label for="image-style-select" class="section-description">Style</label>
          <select id="image-style-select" class="image-style-select">
            <option value="realistic" selected>Realistic</option>
            <option value="anime">Studio Ghibli</option>
            <option value="handdrawing">Handdrawing</option>
            <option value="custom1">Custom 1</option>
            <option value="custom2">Custom 2</option>
          </select>
        </div>
        <div class="image-guidance-field">
          <label for="image-guidance-textarea" class="section-description">Prompt</label>
          <textarea id="image-guidance-textarea" placeholder="Describe the image you want to create..."></textarea>
        </div>
        <div class="image-guidance-buttons">
          <button class="btn-secondary" id="skip-guidance-btn">Cancel</button>
          <button class="btn-primary" id="apply-guidance-btn">Create image</button>
        </div>
      </div>

      <!-- Unauthorized View -->
      <div class="image-guidance-body unauth-view" id="image-guidance-unauth-view" style="display: none;">
        <div class="image-guidance-promo">
          <span class="material-symbols-outlined"
            style="font-size: 48px; color: var(--accent); margin-bottom: 16px;">auto_awesome</span>
          <h3 class="side-menu-title">Premium Feature</h3>
          <p class="section-description" style="margin: 12px 0 24px;">
            Image generation is available for registered users.
            Join Mindcomplete to bring your thoughts to life.
          </p>
        </div>
        <div class="image-guidance-buttons" style="flex-direction: column; width: 100%; gap: 12px;">
          <button class="btn-primary" id="image-unauth-signup-btn" style="width: 100%;">Join now</button>
          <button class="btn-secondary" id="image-unauth-signin-btn" style="width: 100%;">Sign in</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Modal -->
  <div class="modal" id="projects-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header">
        <div class="header-spacer"></div>
        <span class="context-modal-title">Projects</span>
        <div class="header-spacer"></div>
      </div>
      <div class="context-modal-body">
        <div class="context-section">
          <div class="section-header">
            <p class="section-description">Your saved projects</p>
          </div>
          <div class="projects-list" id="projects-list"></div>
          <div class="projects-empty" id="projects-empty">
            <p class="section-description">No projects saved yet</p>
          </div>
          <div class="section-buttons">
            <button class="btn-primary" id="new-project-btn">
              <span class="material-symbols-outlined">add</span>
              New project
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="auth-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header close-only">
        <button class="context-modal-close" id="auth-modal-close" aria-label="Close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="context-modal-body">

        <!-- Title -->
        <h2 class="auth-modal-title" id="auth-modal-title" style="margin: 0;">Sign In</h2>

        <!-- Sign In Layout: Google first -->
        <div id="auth-signin-layout">
          <button class="btn-google" id="auth-google-btn">
            <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="20px" height="20px">
              <path fill="#FFC107"
                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z" />
              <path fill="#FF3D00"
                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z" />
              <path fill="#4CAF50"
                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z" />
              <path fill="#1976D2"
                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z" />
            </svg>
            <span id="auth-google-text">Sign in with Google</span>
          </button>

          <div class="auth-divider" style="margin: 36px 0;">
            <span class="auth-divider-text">or</span>
          </div>

          <div class="auth-form" id="auth-form-section" style="margin-bottom: 36px;">
            <input type="email" id="auth-email" class="auth-input" placeholder="Email">
            <input type="password" id="auth-password" class="auth-input" placeholder="Password">
            <div class="auth-error" id="auth-error"></div>
          </div>

          <button class="btn-primary" id="auth-submit-btn" style="width: 100%;">Sign In</button>
        </div>

        <!-- Create Account Layout: Email first (hidden by default) -->
        <div id="auth-signup-layout" style="display: none;">
          <div class="auth-form" style="margin-bottom: 36px;">
            <input type="email" id="auth-email-signup" class="auth-input" placeholder="Email">
            <input type="password" id="auth-password-signup" class="auth-input" placeholder="Password">
            <div class="auth-error" id="auth-error-signup"></div>
          </div>

          <button class="btn-primary" id="auth-submit-btn-signup" style="width: 100%; margin-bottom: 36px;">Create
            Account</button>

          <div class="auth-divider" style="margin: 0;">
            <span class="auth-divider-text">or</span>
          </div>

          <button class="btn-google" id="auth-google-btn-signup" style="margin-top: 36px;">
            <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="20px" height="20px">
              <path fill="#FFC107"
                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z" />
              <path fill="#FF3D00"
                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z" />
              <path fill="#4CAF50"
                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z" />
              <path fill="#1976D2"
                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z" />
            </svg>
            <span>Sign up with Google</span>
          </button>
        </div>

        <!-- Footer -->
        <div class="auth-footer" style="margin: 0;">
          <p id="auth-toggle-text">Don't have an account? <a href="#" id="auth-toggle-mode">Create one</a></p>
        </div>

      </div>
    </div>
  </div>

  <!-- Account Modal (Simplified) -->
  <div class="modal" id="edit-name-modal">
    <div class="modal-content context-modal-content">
      <div class="context-modal-header close-only">
        <button class="context-modal-close" id="edit-name-close" aria-label="Close">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="context-modal-body">
        <h2 class="auth-modal-title" style="margin: 0;">Account</h2>

        <div>
          <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 8px;">Name</label>
          <input type="text" id="edit-name-input" class="auth-input" placeholder="Your name">
        </div>

        <div>
          <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 8px;">Email</label>
          <input type="text" id="account-email-display" class="auth-input" readonly
            style="background: var(--surface); color: var(--text-muted); cursor: default;">
        </div>

        <button class="btn-primary" id="edit-name-save" style="width: 100%">Save Name</button>

        <div style="border-top: 1px solid var(--border); margin-top: 8px; padding-top: 24px;">
          <button class="btn-danger" id="delete-account-btn" style="width: 100%; justify-content: center;">Delete
            Account</button>
        </div>
      </div>
    </div>
  </div>


  <!-- User Menu (Left Sidebar) -->
  <div class="menu-overlay user-menu-overlay">
    <div class="menu-content user-menu-content">
      <!-- User Profile Header (Click to edit) -->
      <button class="menu-item" id="user-menu-header">
        <span class="material-symbols-outlined">account_circle</span>
        <span class="menu-label">Account</span>
      </button>

      <button class="menu-item" id="user-logout-btn">
        <span class="material-symbols-outlined">logout</span>
        <span class="menu-label">Log out</span>
      </button>
    </div>
  </div>

  <!-- Project Context Menu -->
  <div class="menu-overlay project-menu-overlay" id="project-context-menu">
    <div class="menu-content" style="min-width: 160px;">
      <button class="menu-item rename-project-btn">
        <span class="material-symbols-outlined">edit</span>
        <span class="menu-label">Rename</span>
      </button>
      <button class="menu-item share-project-btn">
        <span class="material-symbols-outlined">share</span>
        <span class="menu-label">Share</span>
      </button>
      <button class="menu-item delete-project-btn" style="color: rgb(231, 76, 60);">
        <span class="material-symbols-outlined">delete</span>
        <span class="menu-label">Delete</span>
      </button>
    </div>
  </div>

  <script type="module" src="supabaseClient.js"></script>
  <script src="debug-clicks.js"></script>
  <script src="app.js?v=fix-sidebar-error"></script>
</body>

</html>